# Реестр на отгрузку

## Описание

Реестр на отгрузку - это отдельная модель для управления доставками. Записи в реестре могут создаваться:
1. **Автоматически** - из рекламаций (когда товар готов к отгрузке)
2. **Вручную** - для обычных заказов (не рекламаций)

---

## Модель ShippingRegistry

### Основные поля

**Связь с рекламацией:**
- `complaint` - OneToOne связь (опционально)

**Информация о заказе:**
- `order_number` - номер заказа
- `manager` - ответственный менеджер
- `created_at` - дата добавления в реестр

**Информация о клиенте:**
- `client_name` - наименование клиента
- `address` - адрес доставки
- `contact_person` - контактное лицо
- `contact_phone` - телефон

**Детали заказа:**
- `doors_count` - количество дверей
- `lift_type` - чей подъем (Наш/Клиент)
- `lift_method` - способ подъема (Лифт/Ручной)
- `order_type` - вид заказа (Основной/Рекламация)
- `payment_status` - статус оплаты
- `delivery_destination` - куда везем (Клиент/На склад)

**Доставка:**
- `planned_shipping_date` - плановая дата отгрузки
- `actual_shipping_date` - фактическая дата отгрузки
- `delivery_status` - статус доставки
- `client_rating` - оценка клиента (1-5)
- `comments` - комментарии

---

## Выпадающие списки

### Чей подъем (lift_type)
- **Наш** - подъем организуем мы
- **Клиент** - клиент организует подъем

### Как подъем (lift_method)
- **Лифт** - подъем на лифте
- **Ручной** - ручной подъем

### Вид заказа (order_type)
- **Основной** - обычный заказ
- **Рекламация** - заказ из рекламации (автоматически)

### Куда везем (delivery_destination)
- **Клиент** - доставка клиенту
- **На склад** - доставка на склад

### Статус доставки (delivery_status)
- **Ожидает отгрузки** - товар готов, ждет отправки
- **В пути** - заказ в процессе доставки
- **Доставлено** - заказ доставлен
- **Отменено** - доставка отменена

---

## Автоматическое создание из рекламации

### Метод: `complaint.add_to_shipping_registry()`

**Параметры:**
- `doors_count` - количество дверей (по умолчанию 1)
- `lift_type` - чей подъем (по умолчанию 'our')
- `lift_method` - способ подъема (по умолчанию 'elevator')
- `payment_status` - оплата (по умолчанию '')
- `delivery_destination` - куда везем (по умолчанию 'client')
- `comments` - комментарии (по умолчанию '')

**Автоматически заполняются:**
- `order_type='complaint'` - всегда "Рекламация"
- `order_number`, `manager`, `client_name`, `address`, `contact_person`, `contact_phone` - из рекламации
- `planned_shipping_date` - из рекламации

**Пример использования:**
```python
# В view менеджера при планировании отгрузки
complaint.add_to_shipping_registry(
    doors_count=3,
    lift_type='our',
    lift_method='elevator',
    payment_status='Оплачено',
    comments='Срочная доставка'
)
```

---

## Визуальные особенности

### Выделение рекламационных заказов
Строки с `order_type='complaint'` выделяются **розовым фоном** (`bg-red-50`)

### Оценка клиента
Отображается звездочками (⭐⭐⭐⭐⭐):
- Заполненные звезды (желтые) - до значения оценки
- Пустые звезды (серые) - остальные
- Если оценки нет - прочерк (—)

---

## Статистика

На странице реестра показывается:
1. **Всего** - общее количество записей
2. **Ожидает** - со статусом "Ожидает отгрузки"
3. **В пути** - со статусом "В пути"
4. **Доставлено** - со статусом "Доставлено"
5. **Рекламации** - количество рекламационных заказов

---

## Фильтры

### Доступные фильтры:
- **Вид заказа** - Основной/Рекламация
- **Статус доставки** - Ожидает/В пути/Доставлено
- **Менеджер** - выбор конкретного менеджера
- **Поиск** - по номеру заказа, клиенту, контактному лицу, адресу

---

## Права доступа

### По городам:
- **Admin/Leader** - видят все записи по всем городам
- **СМ/Менеджер** - видят только записи своего города (по городу менеджера)
- **ОР** - видят все записи (работают со всеми городами)

### По ролям:
- **Manager** - может добавлять/редактировать записи
- **Service Manager** - может просматривать и редактировать
- **Complaint Department** - может просматривать
- **Admin/Leader** - полный доступ

---

## Workflow

### 1. Добавление рекламации в реестр

Когда менеджер планирует отгрузку рекламации:
```python
complaint.plan_shipping(shipping_date)
complaint.add_to_shipping_registry(
    doors_count=...,
    lift_type=...,
    # остальные параметры
)
```

### 2. Ручное добавление заказа

Менеджер добавляет обычный (не рекламационный) заказ через форму на странице реестра.

### 3. Обновление статуса доставки

По мере выполнения доставки статус обновляется:
- Создано → **Ожидает отгрузки**
- Отгружено → **В пути**
- Получено → **Доставлено**

### 4. Оценка клиента

После доставки менеджер вносит оценку клиента (1-5 звезд).

---

## Таблица реестра

### Столбцы (всего 16):
1. № - порядковый номер
2. Номер заказа
3. Менеджер
4. Клиент
5. Адрес
6. Контактное лицо
7. Телефон
8. Количество дверей
9. Чей подъем
10. Как подъем
11. Вид заказа
12. Оплата
13. Куда везем
14. Комментарии
15. Статус доставки
16. Оценка клиента (звездочки)
17. Действия (Просмотр/Изменить)

---

*Документ создан: 2024*  
*Версия: 1.0*  
*Статус: Активная*

